<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StreamFlix — Netflix-style Responsive UI</title>
  <meta name="description" content="Netflix 스타일의 반응형 스트리밍 UI 데모 (HTML/CSS/JS only)" />
  <style>
    :root {
      --hero-bg: url('https://images.unsplash.com/photo-1524985069026-dd778a71c7b4?auto=format&fit=crop&w=2400&q=70');
      --bg: #000;
      --panel: rgba(20, 20, 24, 0.75);
      --text: #f4f4f5;
      --muted: rgba(244, 244, 245, 0.72);
      --muted2: rgba(244, 244, 245, 0.55);
      --accent: #e50914;
      --shadow: 0 16px 48px rgba(0,0,0,.55);
      --shadow2: 0 8px 24px rgba(0,0,0,.45);
      --radius: 16px;
      --radius2: 12px;
      --max: 1200px;
      --safe: clamp(16px, 4vw, 28px);
      --cardW: 180px;
      --cardH: 252px;
      --gap: 14px;
      --ease: cubic-bezier(.2,.8,.2,1);
    }

    * { box-sizing: border-box; }
html, body { height: 100%; }
body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: #000;
      color: var(--text);
      overflow-x: hidden;
}
a { color: inherit; text-decoration: none; }
    button { font: inherit; }

    /* Backdrop wrapper */
    .backdrop {
      position: relative;
      min-height: 100vh;
      isolation: isolate;
    }

    /* Top Nav */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,0.70), rgba(0,0,0,0.12));
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .nav {
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px var(--safe);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      min-width: 120px;
    }

    .logo {
      width: 26px;
      height: 26px;
      border-radius: 8px;
      background: var(--accent);
      box-shadow: 0 10px 24px rgba(229, 9, 20, 0.35);
      position: relative;
      overflow: hidden;
    }
    .logo::before {
      content: "";
      position: absolute;
      inset: -8px;
      background: linear-gradient(120deg, rgba(255,255,255,0.0), rgba(255,255,255,0.22), rgba(255,255,255,0.0));
      transform: translateX(-40%) rotate(20deg);
      animation: shine 3.8s var(--ease) infinite;
    }
    @keyframes shine {
      0%, 40% { transform: translateX(-60%) rotate(20deg); }
      70%, 100% { transform: translateX(70%) rotate(20deg); }
    }

    .brand strong {
      letter-spacing: 0.2px;
      font-weight: 800;
      font-size: 16px;
    }

    .nav-links {
      display: none;
      gap: 18px;
      align-items: center;
      color: var(--muted);
      font-weight: 600;
      font-size: 13px;
      white-space: nowrap;
      overflow-x: auto;
    }
    .nav-links a {
      padding: 8px 10px;
      border-radius: 999px;
      transition: background .2s var(--ease), color .2s var(--ease);
    }
    .nav-links a:hover { background: rgba(255,255,255,0.08); color: var(--text); }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .icon-btn {
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      color: var(--text);
      height: 38px;
      width: 38px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: transform .16s var(--ease), background .16s var(--ease), border-color .16s var(--ease);
    }
    .icon-btn:hover { transform: translateY(-1px); background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.16); }

    .btn {
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      height: 38px;
      padding: 0 14px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      transition: transform .16s var(--ease), background .16s var(--ease), border-color .16s var(--ease);
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    .btn:hover { transform: translateY(-1px); background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.18); }

    .btn.primary {
      background: var(--accent);
      border-color: rgba(229, 9, 20, 0.6);
      box-shadow: 0 12px 30px rgba(229, 9, 20, 0.35);
    }
    .btn.primary:hover { background: #ff0a16; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--muted);
      font-size: 12px;
      font-weight: 650;
      user-select: none;
    }

    /* Hero (Netflix-style) */
    .hero-banner {
      position: relative;
      z-index: 1;
      height: min(84vh, 760px);
      min-height: 520px;
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      overflow: hidden;

      /* ✅ 배경을 요소 자체에 직접 적용 (pseudo-element 이슈 방지) */
      background-color: #000;
      background-image: var(--hero-bg);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
      overflow: hidden;
    }

    /* hero-banner background handled on element itself */
    .hero-banner::before { content: none; }

    .hero-banner::after {
      content: "";
      position: absolute;
      inset: 0;
      /* ✅ 배경이 안 보일 정도로 어두워지는 문제 방지: 오버레이를 최소화 */
      background:
        linear-gradient(90deg, rgba(0,0,0,0.70) 0%, rgba(0,0,0,0.35) 45%, rgba(0,0,0,0.10) 75%, rgba(0,0,0,0.00) 100%),
        linear-gradient(180deg, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.35) 70%, rgba(0,0,0,0.80) 100%);
      z-index: 1;
      pointer-events: none;
    }

    .hero-inner {
      position: relative;
      z-index: 2;
      height: 100%;
      max-width: var(--max);
      margin: 0 auto;
      padding: 86px var(--safe) 56px;
      display: grid;
      align-items: end;
    }

    .hero-stack {
      max-width: 620px;
      display: grid;
      gap: 14px;
    }

    .hero-kicker {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      color: rgba(255,255,255,0.86);
      font-weight: 800;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      font-size: 13px;
    }

    .hero-kicker .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 10px 24px rgba(229, 9, 20, 0.35);
    }

    .hero-title {
      margin: 0;
      font-size: clamp(38px, 6vw, 64px);
      line-height: 1.02;
      letter-spacing: -0.03em;
      font-weight: 900;
    }

    .hero-desc {
      margin: 0;
      color: rgba(255,255,255,0.82);
      font-size: clamp(14px, 1.7vw, 18px);
      line-height: 1.55;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .hero-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .btn.hero {
      height: 48px;
      padding: 0 18px;
      font-size: 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
    }

    .btn.hero.primary {
      background: rgba(255,255,255,0.92);
      color: rgba(0,0,0,0.92);
      border-color: rgba(255,255,255,0.35);
      box-shadow: 0 16px 44px rgba(0,0,0,0.55);
    }

    .btn.hero.primary:hover { background: rgba(255,255,255,0.98); }

    .btn.hero.secondary {
      background: rgba(109, 109, 110, 0.45);
      border-color: rgba(255,255,255,0.14);
    }

    .hero-meta {
      margin-top: 8px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      color: rgba(255,255,255,0.70);
      font-size: 13px;
      font-weight: 650;
    }

    .hero-age {
      position: absolute;
      right: 0;
      bottom: 46px;
      z-index: 3;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .hero-age .age {
      padding: 10px 12px;
      border-left: 3px solid rgba(255,255,255,0.9);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.92);
      font-weight: 850;
      border-radius: 10px 0 0 10px;
      letter-spacing: 0.02em;
    }

    .hero-age .vol {
      height: 38px;
      width: 38px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.9);
      display: grid;
      place-items: center;
      cursor: pointer;
    }

    /* Rows */
    main {
      max-width: var(--max);
      margin: 0 auto;
      padding: 10px var(--safe) 60px;
      position: relative;
      z-index: 2;
    }

    /* 페이지 전체(히어로 아래) 배경을 더 진한 블랙으로 */
    main::before {
      content: "";
      position: absolute;
      /* ⚠️ 기존 -40px 때문에 히어로까지 덮어서 히어로가 안 보일 수 있었음 */
      inset: 0 calc(var(--safe) * -1) -60px;
      background: #000;
      z-index: -1;
      pointer-events: none;
    }

    .row { margin-top: 22px; }

    /* 각 섹션(시리즈/레일)도 완전 블랙 기반 */
    .row { position: relative; }
    .row::before {
      content: "";
      position: absolute;
      inset: -10px -10px;
      background: #000;
      opacity: 0.92;
      z-index: -1;
      pointer-events: none;
      border-radius: 18px;
    }

    .row-head {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .row h3 {
      margin: 0;
      font-size: 18px;
      letter-spacing: -0.01em;
    }

    .row .sub {
      margin: 0;
      color: var(--muted2);
      font-size: 12px;
    }

    .rail {
      position: relative;
      border-radius: var(--radius);
      background: rgba(0,0,0,0.80);
      border: 1px solid rgba(255,255,255,0.08);
      overflow: hidden;
      box-shadow: var(--shadow2);
    }

    .rail-inner {
      display: flex;
      gap: var(--gap);
      padding: 14px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.25) rgba(0,0,0,0.0);
    }

    .rail-inner::-webkit-scrollbar { height: 10px; }
    .rail-inner::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.18);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0.35);
    }
    .rail-inner::-webkit-scrollbar-track { background: rgba(0,0,0,0.0); }

    .card {
      scroll-snap-align: start;
      flex: 0 0 auto;
      width: var(--cardW);
      border-radius: var(--radius2);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.10);
      background: var(--panel);
      position: relative;
      cursor: pointer;
      transition: transform .22s var(--ease), box-shadow .22s var(--ease), border-color .22s var(--ease);
    }
    .card:hover {
      transform: translateY(-2px) scale(1.02);
      border-color: rgba(255,255,255,0.20);
      box-shadow: 0 16px 40px rgba(0,0,0,0.55);
    }

    .thumb {
      height: var(--cardH);
      background-size: cover;
      background-position: center;
      filter: saturate(1.05) contrast(1.05);
    }

    .card .info { padding: 10px 10px 12px; display: grid; gap: 6px; }

    .card .t {
      margin: 0;
      font-weight: 800;
      font-size: 13px;
      letter-spacing: -0.01em;
      line-height: 1.2;
    }

    .card .m {
      margin: 0;
      color: var(--muted2);
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .tag {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.78);
      font-size: 11px;
      font-weight: 700;
    }

    /* Rail controls */
    .rail-controls {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .arrow {
      pointer-events: auto;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      height: 44px;
      width: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.55);
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: transform .16s var(--ease), background .16s var(--ease), opacity .16s var(--ease);
      opacity: 0;
    }
    .rail:hover .arrow { opacity: 1; }
    .arrow:hover { transform: translateY(-50%) scale(1.04); background: rgba(0,0,0,0.70); }
    .arrow.left { left: 10px; }
    .arrow.right { right: 10px; }

    /* Modal */
    /* Safe-area & mobile bottom clipping fixes */
:root{
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-top: env(safe-area-inset-top, 0px);
}

.modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: calc(18px + var(--safe-top)) 18px calc(18px + var(--safe-bottom));
      background: rgba(0,0,0,0.65);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s var(--ease);
      z-index: 100;
    }
    .modal.open { opacity: 1; pointer-events: auto; }

    .modal-card {
      width: min(980px, 100%);
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(20,20,24,0.84);
      box-shadow: var(--shadow);
      transform: translateY(8px);
      transition: transform .18s var(--ease);
    }
    .modal.open .modal-card { transform: translateY(0); }

    .modal-hero {
      position: relative;
      aspect-ratio: 16 / 8;
      background: #111;
      overflow: hidden;
    }

    .modal-hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      filter: saturate(1.05) contrast(1.05);
      transform: scale(1.02);
    }

    .modal-hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.05), rgba(0,0,0,0.85));
    }

    .modal-bar {
      position: absolute;
      inset: 0;
      padding: 14px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      z-index: 1;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.86);
      font-size: 12px;
      font-weight: 850;
      user-select: none;
    }

    .close {
      height: 40px;
      width: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.55);
      color: var(--text);
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: transform .16s var(--ease), background .16s var(--ease);
    }
    .close:hover { transform: scale(1.04); background: rgba(0,0,0,0.70); }

    .modal-body { padding: 16px; display: grid; gap: 12px; }

    .modal-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .modal-title h4 {
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.01em;
    }

    .mini-actions { display: flex; gap: 10px; flex-wrap: wrap; }

    .mini {
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.10);
      color: var(--text);
      height: 38px;
      padding: 0 14px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 13px;
      cursor: pointer;
      transition: transform .16s var(--ease), background .16s var(--ease), border-color .16s var(--ease);
    }
    .mini:hover { transform: translateY(-1px); background: rgba(255,255,255,0.14); border-color: rgba(255,255,255,0.18); }

    .modal-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      color: rgba(255,255,255,0.75);
      font-size: 12px;
    }

    .modal-desc {
      margin: 0;
      color: rgba(255,255,255,0.78);
      line-height: 1.6;
      font-size: 14px;
    }

    .kbd {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.82);
    }

    footer.site-footer{
      width: 100%;
      background: #000;
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .footer-inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 32px var(--safe) 42px;
      display: grid;
      gap: 18px;
    }

    .footer-note{
      margin: 10px 0 0;
      max-width: 78ch;
      line-height: 1.6;
      color: var(--muted2);
      font-size: 13px;
    }

    .footer-links{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
      align-items: center;
      color: rgba(255,255,255,0.70);
      font-weight: 700;
      font-size: 13px;
    }
    .footer-links a{
      padding: 8px 10px;
      border-radius: 999px;
      transition: background .2s var(--ease), color .2s var(--ease);
    }
    .footer-links a:hover{ background: rgba(255,255,255,0.08); color: var(--text); }

    .footer-meta{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    /* Search Drawer */
    .drawer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s var(--ease);
      z-index: 80;
    }
    .drawer.open { opacity: 1; pointer-events: auto; }

    .drawer-panel {
      position: absolute;
      top: 0;
      right: 0;
      height: 100dvh;
      width: min(420px, 92vw);
      background: rgba(20,20,24,0.90);
      border-left: 1px solid rgba(255,255,255,0.10);
      box-shadow: var(--shadow);
      transform: translateX(16px);
      transition: transform .18s var(--ease);
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 10px;
      padding: 14px 14px calc(14px + var(--safe-bottom));
      overflow: hidden;
    }
    .drawer.open .drawer-panel { transform: translateX(0); }

    .drawer-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .drawer-title { margin: 0; font-size: 14px; color: rgba(255,255,255,0.9); }

    .search { display: flex; gap: 10px; align-items: center; }

    .search input {
      flex: 1;
      height: 42px;
      padding: 0 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.35);
      color: var(--text);
      outline: none;
    }

    .search input:focus { border-color: rgba(229, 9, 20, 0.55); }

    .result {
      display: grid;
      gap: 10px;
      overflow: auto;
      padding-right: 4px;
    }

    .result .item {
      display: grid;
      grid-template-columns: 56px 1fr;
      gap: 10px;
      align-items: center;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.28);
      cursor: pointer;
      transition: transform .16s var(--ease), border-color .16s var(--ease), background .16s var(--ease);
    }

    .result .item:hover { transform: translateY(-1px); border-color: rgba(255,255,255,0.16); background: rgba(255,255,255,0.05); }

    .result .ph {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      background-size: cover;
      background-position: center;
      border: 1px solid rgba(255,255,255,0.10);
    }

    .result .name { margin: 0; font-weight: 850; font-size: 13px; }
    .result .meta { margin: 0; color: var(--muted2); font-size: 12px; }

    /* Responsive */
    @media (min-width: 880px) { .nav-links { display: flex; } }

    @media (max-width: 520px) {
      :root { --cardW: 150px; --cardH: 210px; }
      .btn { padding: 0 12px; }
      .hero-inner { padding-top: 66px; }
      .hero-title { font-size: 36px; }
    }

    @media (prefers-reduced-motion: reduce) {
      * { scroll-behavior: auto !important; }
      .logo::before { animation: none; }
      .card, .btn, .icon-btn, .mini, .arrow, .modal, .modal-card, .drawer, .drawer-panel { transition: none !important; }
    }
  </style>
</head>

<body>
  <div class="backdrop">
    <header>
      <div class="nav">
        <a class="brand" href="#" aria-label="StreamFlix 홈">
          <span class="logo" aria-hidden="true"></span>
          <strong>StreamFlix</strong>
        </a>

        <nav class="nav-links" aria-label="주요 메뉴">
          <a href="#netflix">Netflix</a>
          <a href="#trending">지금 상영 중</a>
          <a href="#new">인기 영화</a>
          <a href="#top10">TOP 10</a>
          <a href="#comedy">코미디</a>
          <a href="#action">액션</a>
          <a href="#doc">다큐</a>
          <a href="#my">내 리스트</a>
        </nav>

        <div class="nav-actions">
          <button class="icon-btn" id="openSearch" aria-label="검색 열기" title="검색">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/>
              <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <button class="btn" id="btnSignIn" aria-label="로그인">로그인</button>
          <button class="btn primary" id="btnJoin" aria-label="가입하기">
            <span>시작하기</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M9 18 15 12 9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <section class="hero-banner" aria-label="히어로">
      <div class="hero-inner">
        <div class="hero-stack">
          <div class="hero-kicker"><span class="dot" aria-hidden="true"></span><span id="heroSource">NETFLIX SERIES</span></div>
          <h1 class="hero-title" id="heroTitle">Loading...</h1>
          <p class="hero-desc" id="heroDesc">데이터를 불러오는 중입니다.</p>

          <div class="hero-actions">
            <button class="btn hero primary" id="playHero" aria-label="재생">▶ 재생</button>
            <button class="btn hero secondary" id="infoHero" aria-label="상세 정보">ⓘ 상세 정보</button>
            <button class="btn hero secondary" id="addHero" aria-label="내 리스트">+ 내 리스트</button>
          </div>

          <div class="hero-meta" id="heroMeta"></div>
        </div>

        <div class="hero-age" aria-hidden="false">
          <button class="vol" id="muteHero" aria-label="음소거 토글" title="음소거">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M11 5 6 9H2v6h4l5 4V5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M22 9 16 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M16 9 22 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div class="age" id="heroAge">15+</div>
        </div>
      </div>
    </section>

    <main>
      <section class="row" id="netflix">
        <div class="row-head">
          <div>
            <h3>Netflix 상영작 (TV)</h3>
            <p class="sub">TMDB discover/tv (with_networks=213)</p>
          </div>
          <span class="pill">Netflix</span>
        </div>

        <div class="rail" data-rail="netflix">
          <div class="rail-inner" id="railNetflix"></div>
          <div class="rail-controls" aria-hidden="true">
            <button class="arrow left" data-dir="left" aria-label="왼쪽으로" title="왼쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18 9 12l6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="arrow right" data-dir="right" aria-label="오른쪽으로" title="오른쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>
      </section>

      <section class="row" id="trending">
        <div class="row-head">
          <div>
            <h3>지금 상영 중</h3>
            <p class="sub">TMDB now_playing</p>
          </div>
          <span class="pill">Now Playing</span>
        </div>

        <div class="rail" data-rail="trending">
          <div class="rail-inner" id="railTrending"></div>
          <div class="rail-controls" aria-hidden="true">
            <button class="arrow left" data-dir="left" aria-label="왼쪽으로" title="왼쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18 9 12l6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="arrow right" data-dir="right" aria-label="오른쪽으로" title="오른쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>
      </section>

      <section class="row" id="new">
        <div class="row-head">
          <div>
            <h3>인기 영화</h3>
            <p class="sub">TMDB popular</p>
          </div>
          <span class="pill">Popular</span>
        </div>

        <div class="rail" data-rail="new">
          <div class="rail-inner" id="railNew"></div>
          <div class="rail-controls" aria-hidden="true">
            <button class="arrow left" data-dir="left" aria-label="왼쪽으로" title="왼쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18 9 12l6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="arrow right" data-dir="right" aria-label="오른쪽으로" title="오른쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>
      </section>

      <section class="row" id="top10">
        <div class="row-head">
          <div>
            <h3>TOP 10 · 평점 순위</h3>
            <p class="sub">TMDB top_rated</p>
          </div>
          <span class="pill">Top Rated</span>
        </div>

        <div class="rail" data-rail="top10">
          <div class="rail-inner" id="railTop"></div>
          <div class="rail-controls" aria-hidden="true">
            <button class="arrow left" data-dir="left" aria-label="왼쪽으로" title="왼쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18 9 12l6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="arrow right" data-dir="right" aria-label="오른쪽으로" title="오른쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>
      </section>

      <section class="row" id="comedy">
        <div class="row-head">
          <div>
            <h3>코미디 영화</h3>
            <p class="sub">TMDB discover (with_genres=35)</p>
          </div>
          <span class="pill">Comedy</span>
        </div>

        <div class="rail" data-rail="comedy">
          <div class="rail-inner" id="railComedy"></div>
          <div class="rail-controls" aria-hidden="true">
            <button class="arrow left" data-dir="left" aria-label="왼쪽으로" title="왼쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18 9 12l6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="arrow right" data-dir="right" aria-label="오른쪽으로" title="오른쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>
      </section>

      <section class="row" id="action">
        <div class="row-head">
          <div>
            <h3>액션 영화</h3>
            <p class="sub">TMDB discover (with_genres=28)</p>
          </div>
          <span class="pill">Action</span>
        </div>

        <div class="rail" data-rail="action">
          <div class="rail-inner" id="railAction"></div>
          <div class="rail-controls" aria-hidden="true">
            <button class="arrow left" data-dir="left" aria-label="왼쪽으로" title="왼쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18 9 12l6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="arrow right" data-dir="right" aria-label="오른쪽으로" title="오른쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>
      </section>

      <section class="row" id="doc">
        <div class="row-head">
          <div>
            <h3>다큐멘터리 영화</h3>
            <p class="sub">TMDB discover (with_genres=99)</p>
          </div>
          <span class="pill">Documentary</span>
        </div>

        <div class="rail" data-rail="doc">
          <div class="rail-inner" id="railDoc"></div>
          <div class="rail-controls" aria-hidden="true">
            <button class="arrow left" data-dir="left" aria-label="왼쪽으로" title="왼쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18 9 12l6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="arrow right" data-dir="right" aria-label="오른쪽으로" title="오른쪽">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>
      </section>

      <section class="row" id="my">
        <div class="row-head">
          <div>
            <h3>내 리스트</h3>
            <p class="sub">+ 버튼으로 담고, 여기서 확인</p>
          </div>
          <span class="pill" id="myCount">0개</span>
        </div>

        <div class="rail">
          <div class="rail-inner" id="railMy"></div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <div class="footer-brand">
          <div style="display:flex; align-items:center; gap:10px;">
            <span class="logo" aria-hidden="true" style="width:18px;height:18px;border-radius:6px;"></span>
            <strong style="font-size:14px;">StreamFlix</strong>
          </div>
          <p class="footer-note">
            교육용 데모 UI입니다. 실제 Netflix의 자산/브랜딩/콘텐츠를 사용하지 않았습니다.
            데이터는 TMDB API를 통해 가져옵니다.
          </p>
        </div>

        <div class="footer-links" aria-label="푸터 링크">
          <a href="#netflix">Netflix</a>
          <a href="#trending">정보</a>
          <a href="#top10">지원</a>
          <a href="#my">회사</a>
          <a href="#" id="openLoginFooter">정보</a>
        </div>

        <div class="footer-meta">
          <span class="pill">Tip: 카드 클릭 → 상세 모달</span>
          <span class="pill">Tip: <span class="kbd">/</span> 검색</span>
        </div>
      </div>
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="콘텐츠 상세" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-hero" id="modalHero">
        <div class="modal-bar">
          <span class="badge" id="modalBadge">FEATURED</span>
          <button class="close" id="closeModal" aria-label="닫기 (ESC)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="modal-body">
        <div class="modal-title">
          <h4 id="modalTitle">Title</h4>
          <div class="mini-actions">
            <button class="mini" id="modalPlay">▶ 재생</button>
            <button class="mini" id="modalAdd">+ 내 리스트</button>
          </div>
        </div>
        <div class="modal-meta" id="modalMeta"></div>
        <p class="modal-desc" id="modalDesc"></p>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal" id="loginModal" role="dialog" aria-modal="true" aria-label="로그인" aria-hidden="true">
    <div class="modal-card" role="document" style="width:min(520px, 100%);">
      <div class="modal-hero" style="aspect-ratio: 16/6;" id="loginHero">
        <div class="modal-bar">
          <span class="badge">SIGN IN</span>
          <button class="close" id="closeLogin" aria-label="로그인 닫기 (ESC)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="modal-body">
        <div class="modal-title">
          <h4 style="margin:0;">로그인</h4>
        </div>

        <form id="loginForm" style="display:grid; gap: 12px;" autocomplete="on">
          <label style="display:grid; gap: 8px;">
            <span style="color: rgba(255,255,255,0.78); font-weight: 750; font-size: 13px;">이메일</span>
            <input id="loginEmail" type="email" required placeholder="you@example.com"
              style="height:44px; padding:0 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background: rgba(0,0,0,0.35); color: var(--text); outline:none;" />
          </label>

          <label style="display:grid; gap: 8px;">
            <span style="color: rgba(255,255,255,0.78); font-weight: 750; font-size: 13px;">비밀번호</span>
            <input id="loginPassword" type="password" required placeholder="••••••••"
              style="height:44px; padding:0 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background: rgba(0,0,0,0.35); color: var(--text); outline:none;" />
          </label>

          <button class="btn primary" type="submit" style="height:44px; border-radius:12px; justify-content:center;">
            로그인
          </button>

          <div style="display:flex; justify-content:space-between; gap: 10px; flex-wrap:wrap; color: rgba(255,255,255,0.62); font-size: 12px;">
            <a href="#" id="forgotPw" style="text-decoration: underline; text-underline-offset: 3px;">비밀번호를 잊으셨나요?</a>
            <a href="#" id="createAccount" style="text-decoration: underline; text-underline-offset: 3px;">계정 만들기</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Search Drawer -->
  <div class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer-panel" role="dialog" aria-modal="true" aria-label="검색">
      <div class="drawer-top">
        <h3 class="drawer-title">검색</h3>
        <button class="close" id="closeDrawer" aria-label="검색 닫기">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="search">
        <input id="searchInput" type="search" placeholder="제목으로 검색" autocomplete="off" />
        <button class="btn primary" id="searchBtn" aria-label="검색 실행" style="height:42px; border-radius: 12px;">검색</button>
      </div>

      <div class="result" id="searchResult" aria-label="검색 결과"></div>

      <div style="color: rgba(255,255,255,0.62); font-size: 12px; line-height:1.5;">
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <span class="pill">단축키 <span class="kbd">/</span></span>
          <span class="pill">모달 닫기 <span class="kbd">ESC</span></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ------------------------------------------------------------
    // TMDB API 기반으로 데이터 로드
    // ------------------------------------------------------------
    // ⚠️ 보안 주의: TMDB API Key를 프론트에 하드코딩하면 노출됩니다.
    // 데모/학습용으로만 사용하고, 실제 서비스에서는 서버 프록시를 사용하세요.

    const TMDB_API_KEY = "0bda5d6b5a7917e8209f970a2db952ee";

    const TMDB_BASE = "https://api.themoviedb.org/3";
    const IMG_500 = "https://image.tmdb.org/t/p/w500";
    const IMG_ORI = "https://image.tmdb.org/t/p/original";
    const LANG = "ko-KR";
    const REGION = "KR";

    const ENDPOINTS = {
      trending: `${TMDB_BASE}/movie/now_playing?language=${LANG}&region=${REGION}&page=1&api_key=${TMDB_API_KEY}`,
      new: `${TMDB_BASE}/movie/popular?language=${LANG}&region=${REGION}&page=1&api_key=${TMDB_API_KEY}`,
      top10: `${TMDB_BASE}/movie/top_rated?language=${LANG}&region=${REGION}&page=1&api_key=${TMDB_API_KEY}`,
      comedy: `${TMDB_BASE}/discover/movie?with_genres=35&language=${LANG}&region=${REGION}&sort_by=popularity.desc&page=1&api_key=${TMDB_API_KEY}`,
      action: `${TMDB_BASE}/discover/movie?with_genres=28&language=${LANG}&region=${REGION}&sort_by=popularity.desc&page=1&api_key=${TMDB_API_KEY}`,
      doc: `${TMDB_BASE}/discover/movie?with_genres=99&language=${LANG}&region=${REGION}&sort_by=popularity.desc&page=1&api_key=${TMDB_API_KEY}`,
      netflix: `${TMDB_BASE}/discover/tv?with_networks=213&language=${LANG}&sort_by=popularity.desc&page=1&api_key=${TMDB_API_KEY}`,
    };

    // DOM
    const railTrending = document.getElementById('railTrending');
    const railNew = document.getElementById('railNew');
    const railTop = document.getElementById('railTop');
    const railComedy = document.getElementById('railComedy');
    const railAction = document.getElementById('railAction');
    const railDoc = document.getElementById('railDoc');
    const railNetflix = document.getElementById('railNetflix');
    const railMy = document.getElementById('railMy');
    const myCount = document.getElementById('myCount');

    const modal = document.getElementById('modal');
    const loginModal = document.getElementById('loginModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalMeta = document.getElementById('modalMeta');
    const modalDesc = document.getElementById('modalDesc');
    const modalBadge = document.getElementById('modalBadge');
    const modalAdd = document.getElementById('modalAdd');
    const modalPlay = document.getElementById('modalPlay');

    const drawer = document.getElementById('drawer');
    const openSearch = document.getElementById('openSearch');
    const closeDrawer = document.getElementById('closeDrawer');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const searchResult = document.getElementById('searchResult');

    // Hero
    const heroMeta = document.getElementById('heroMeta');
    const heroAge = document.getElementById('heroAge');
    const heroTitle = document.getElementById('heroTitle');
    const heroDesc = document.getElementById('heroDesc');
    const heroSource = document.getElementById('heroSource');

    const STATE = {
      trending: [],
      new: [],
      top10: [],
      comedy: [],
      action: [],
      doc: [],
      netflix: [],
    };

    let currentModalItem = null;

    // ------------------------------
    // utils
    // ------------------------------
    function escapeHtml(str) {
      return String(str ?? '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    function formatYear(dateStr) {
      if (!dateStr) return "-";
      const y = String(dateStr).slice(0, 4);
      return y || "-";
    }

    function pickQuality(voteAvg) {
      if (voteAvg >= 8.2) return "4K";
      if (voteAvg >= 7.2) return "HDR";
      return "HD";
    }

    function pickRating(adult) {
      return adult ? "19+" : "12+";
    }

    function rand(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function toast(msg) {
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position = 'fixed';
      t.style.left = '50%';
      t.style.bottom = '22px';
      t.style.transform = 'translateX(-50%)';
      t.style.padding = '10px 14px';
      t.style.borderRadius = '999px';
      t.style.border = '1px solid rgba(255,255,255,0.16)';
      t.style.background = 'rgba(0,0,0,0.65)';
      t.style.backdropFilter = 'blur(10px)';
      t.style.webkitBackdropFilter = 'blur(10px)';
      t.style.color = 'rgba(255,255,255,0.92)';
      t.style.fontWeight = '750';
      t.style.fontSize = '13px';
      t.style.boxShadow = '0 16px 40px rgba(0,0,0,0.55)';
      t.style.zIndex = '999';
      document.body.appendChild(t);
      setTimeout(() => {
        t.style.transition = 'opacity .18s ease';
        t.style.opacity = '0';
        setTimeout(() => t.remove(), 220);
      }, 1400);
    }

    function pill(text) {
      return `<span class="pill" style="padding:7px 10px;">${escapeHtml(text)}</span>`;
    }

    function safeSetHTML(el, html) {
      if (!el) return;
      el.innerHTML = html;
    }

    function skeletonRail(el, count = 10) {
      if (!el) return;
      el.innerHTML = new Array(count).fill(0).map(() => {
        return `
          <div class="card" style="cursor: default;">
            <div class="thumb" style="background: linear-gradient(90deg, rgba(255,255,255,0.05), rgba(255,255,255,0.10), rgba(255,255,255,0.05)); background-size: 200% 100%; animation: sk 1.2s ease-in-out infinite;"></div>
            <div class="info">
              <p class="t" style="height: 14px; width: 70%; background: rgba(255,255,255,0.08); border-radius: 8px; margin: 0;"></p>
              <p class="m" style="height: 12px; width: 90%; background: rgba(255,255,255,0.06); border-radius: 8px; margin: 0;"></p>
            </div>
          </div>
        `;
      }).join('');

      if (!document.getElementById('skStyle')) {
        const st = document.createElement('style');
        st.id = 'skStyle';
        st.textContent = `@keyframes sk{0%{background-position:0% 0%}100%{background-position:200% 0%}}`;
        document.head.appendChild(st);
      }
    }

    // ------------------------------
    // TMDB
    // ------------------------------
    async function fetchJson(url) {
      const res = await fetch(url, { headers: { accept: 'application/json' } });
      if (!res.ok) throw new Error(`TMDB 요청 실패: ${res.status}`);
      return res.json();
    }

    function mapMovieToCard(movie, idx, { rank } = {}) {
      const poster = movie.poster_path ? IMG_500 + movie.poster_path : "";
      const backdrop = movie.backdrop_path ? IMG_ORI + movie.backdrop_path : poster;
      const year = formatYear(movie.release_date);
      const quality = pickQuality(movie.vote_average ?? 0);
      const rating = pickRating(movie.adult);

      return {
        id: `m_${movie.id}`,
        rawId: String(movie.id),
        title: movie.title || movie.name || "Untitled",
        genre: "Movie",
        year,
        rating,
        quality,
        img: poster || "https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?auto=format&fit=crop&w=1200&q=60",
        backdrop: backdrop || poster,
        desc: movie.overview || "설명이 없습니다.",
        minutes: rand(90, 165),
        match: Math.round((movie.vote_average ?? 7.0) * 10),
        rank: rank ? idx + 1 : undefined,
      };
    }

    function mapTvToCard(tv, idx) {
      const poster = tv.poster_path ? IMG_500 + tv.poster_path : "";
      const backdrop = tv.backdrop_path ? IMG_ORI + tv.backdrop_path : poster;
      const year = formatYear(tv.first_air_date);
      const quality = pickQuality(tv.vote_average ?? 0);
      const rating = "12+";

      return {
        id: `t_${tv.id}`,
        rawId: String(tv.id),
        title: tv.name || tv.original_name || "Untitled",
        genre: "TV",
        year,
        rating,
        quality,
        img: poster || "https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?auto=format&fit=crop&w=1200&q=60",
        backdrop: backdrop || poster,
        desc: tv.overview || "설명이 없습니다.",
        minutes: null,
        seasons: rand(1, 8),
        episodes: rand(6, 24),
        match: Math.round((tv.vote_average ?? 7.0) * 10),
      };
    }

    function errorBox() {
      return `
        <div style="min-width: 320px; padding: 14px; color: rgba(255,255,255,0.72); line-height:1.6;">
          데이터를 불러오지 못했습니다. <b>TMDB API Key</b> 또는 네트워크/CORS 환경을 확인해주세요.
        </div>
      `;
    }

    // ------------------------------
    // Render
    // ------------------------------
    function renderRail(el, items, opts = {}) {
      if (!el) return;
      const { showRank = false } = opts;
      el.innerHTML = items.map(item => {
        const rankBadge = showRank
          ? `<span class="badge" style="position:absolute; left:10px; top:10px; background: rgba(0,0,0,0.55); border-color: rgba(255,255,255,0.16);">TOP ${item.rank}</span>`
          : '';

        return `
          <article class="card" data-id="${item.id}" tabindex="0" role="button" aria-label="${escapeHtml(item.title)} 상세 보기">
            ${rankBadge}
            <div class="thumb" style="background-image:url('${item.img}')"></div>
            <div class="info">
              <p class="t">${escapeHtml(item.title)}</p>
              <p class="m">
                <span>${escapeHtml(item.genre)} · ${escapeHtml(item.year)}</span>
                <span class="tag">${escapeHtml(item.quality)}</span>
              </p>
            </div>
          </article>
        `;
      }).join('');
    }

    function syncHero(hero) {
      if (!hero) return;

      const bgUrl = hero.backdrop || hero.img;
      if (bgUrl) document.documentElement.style.setProperty('--hero-bg', `url('${bgUrl}')`);
      if (heroTitle) heroTitle.textContent = hero.title;
      if (heroDesc) heroDesc.textContent = hero.desc;
      if (heroSource) heroSource.textContent = hero.genre === 'TV' ? 'NETFLIX SERIES' : 'MOVIE';
      if (heroAge) heroAge.textContent = hero.rating;

      if (heroMeta) {
        heroMeta.innerHTML = [
          pill(`${hero.match}% Match`),
          pill(`${hero.year}`),
          pill(`${hero.genre}`),
          pill(`${hero.quality}`),
          (hero.genre === 'TV'
            ? pill(`시즌 ${hero.seasons} · 에피소드 ${hero.episodes}`)
            : pill(`${hero.minutes}분`)
          )
        ].join('');
      }
    }

    // Rail arrows
    document.querySelectorAll('.rail').forEach(rail => {
      const inner = rail.querySelector('.rail-inner');
      if (!inner) return;
      rail.querySelectorAll('.arrow').forEach(btn => {
        btn.addEventListener('click', () => {
          const dir = btn.dataset.dir;
          const amount = inner.clientWidth * 0.82;
          inner.scrollBy({ left: dir === 'left' ? -amount : amount, behavior: 'smooth' });
        });
      });
    });

    // ------------------------------
    // Data loader
    // ------------------------------
    async function loadRails() {
      skeletonRail(railNetflix);
      skeletonRail(railTrending);
      skeletonRail(railNew);
      skeletonRail(railTop);
      skeletonRail(railComedy);
      skeletonRail(railAction);
      skeletonRail(railDoc);

      try {
        const [now, pop, top, comedy, action, doc, netflix] = await Promise.all([
          fetchJson(ENDPOINTS.trending),
          fetchJson(ENDPOINTS.new),
          fetchJson(ENDPOINTS.top10),
          fetchJson(ENDPOINTS.comedy),
          fetchJson(ENDPOINTS.action),
          fetchJson(ENDPOINTS.doc),
          fetchJson(ENDPOINTS.netflix),
        ]);

        STATE.trending = (now.results || []).slice(0, 12).map((m, i) => mapMovieToCard(m, i));
        STATE.new = (pop.results || []).slice(0, 12).map((m, i) => mapMovieToCard(m, i));
        STATE.top10 = (top.results || []).slice(0, 10).map((m, i) => mapMovieToCard(m, i, { rank: true }));
        STATE.comedy = (comedy.results || []).slice(0, 12).map((m, i) => mapMovieToCard(m, i));
        STATE.action = (action.results || []).slice(0, 12).map((m, i) => mapMovieToCard(m, i));
        STATE.doc = (doc.results || []).slice(0, 12).map((m, i) => mapMovieToCard(m, i));
        STATE.netflix = (netflix.results || []).slice(0, 12).map((t, i) => mapTvToCard(t, i));

        renderRail(railNetflix, STATE.netflix);
        renderRail(railTrending, STATE.trending);
        renderRail(railNew, STATE.new);
        renderRail(railTop, STATE.top10, { showRank: true });
        renderRail(railComedy, STATE.comedy);
        renderRail(railAction, STATE.action);
        renderRail(railDoc, STATE.doc);

        // Hero sync (Netflix first)
        syncHero(STATE.netflix[0] || STATE.trending[0]);

        runSearch('');
      } catch (err) {
        console.error(err);
        safeSetHTML(railNetflix, errorBox());
        safeSetHTML(railTrending, errorBox());
        safeSetHTML(railNew, errorBox());
        safeSetHTML(railTop, errorBox());
        safeSetHTML(railComedy, errorBox());
        safeSetHTML(railAction, errorBox());
        safeSetHTML(railDoc, errorBox());
        toast('TMDB 데이터를 불러오지 못했습니다. API Key/네트워크를 확인하세요.');
      }
    }

    // ------------------------------
    // Modal
    // ------------------------------
    const dynamicStyle = document.createElement('style');
    dynamicStyle.id = 'modalDynStyle';
    document.head.appendChild(dynamicStyle);

    function syncModalPoster(url) {
      if (!url) return;
      dynamicStyle.textContent = `#modalHero::before{background-image:url('${url}');}`;
    }

    function openModal(item) {
      if (!modal) return;
      currentModalItem = item;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');

      syncModalPoster(item.backdrop || item.img);

      if (modalTitle) modalTitle.textContent = item.title;
      if (modalBadge) modalBadge.textContent = item.rank ? `TOP ${item.rank}` : `${item.match}% Match`;
      if (modalMeta) {
        modalMeta.innerHTML = [
          pill(`${item.year}`),
          pill(`${item.rating}`),
          pill(`${item.genre}`),
          pill(`${item.quality}`),
          (item.genre === 'TV'
            ? pill(`시즌 ${item.seasons} · 에피소드 ${item.episodes}`)
            : pill(`${item.minutes}분`)
          )
        ].join('');
      }
      if (modalDesc) modalDesc.textContent = item.desc;

      if (modalAdd) {
        modalAdd.textContent = isInMyList(item.id) ? '✓ 내 리스트에 있음' : '+ 내 리스트';
        modalAdd.dataset.id = item.id;
      }

      setTimeout(() => document.getElementById('closeModal')?.focus(), 0);
    }

    function closeModal() {
      if (!modal) return;
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
      currentModalItem = null;
    }

    function findItemById(id) {
      const all = [...STATE.netflix, ...STATE.trending, ...STATE.new, ...STATE.top10, ...STATE.comedy, ...STATE.action, ...STATE.doc, ...getMyList()];
      return all.find(x => String(x.id) === String(id));
    }

    document.addEventListener('click', (e) => {
      const card = e.target.closest('.card');
      if (!card) return;
      const item = findItemById(card.dataset.id);
      if (item) openModal(item);
    });

    document.addEventListener('keydown', (e) => {
      const active = document.activeElement;
      if (active?.classList?.contains('card') && (e.key === 'Enter' || e.key === ' ')) {
        e.preventDefault();
        const item = findItemById(active.dataset.id);
        if (item) openModal(item);
      }

      if (e.key === 'Escape') {
        if (modal?.classList?.contains('open')) closeModal();
        if (drawer?.classList?.contains('open')) closeDrawerFn();
        if (loginModal?.classList?.contains('open')) closeLogin();
      }

      if (e.key === '/' && !isTypingInInput()) {
        e.preventDefault();
        openDrawerFn();
      }
    });

    function isTypingInInput() {
      const el = document.activeElement;
      if (!el) return false;
      const tag = el.tagName?.toLowerCase();
      return tag === 'input' || tag === 'textarea' || el.isContentEditable;
    }

    document.getElementById('closeModal')?.addEventListener('click', closeModal);
    modal?.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

    // Hero click opens modal (exclude buttons)
    document.querySelector('.hero-banner')?.addEventListener('click', (e) => {
      if (e.target.closest('button')) return;
      const hero = STATE.netflix[0] || STATE.trending[0];
      if (hero) openModal(hero);
    });

    // ------------------------------
    // My list
    // ------------------------------
    const STORAGE_KEY = "streamflix_my_list_v3";

    function getMyList() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        const parsed = raw ? JSON.parse(raw) : [];
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function setMyList(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    function isInMyList(id) {
      return getMyList().some(x => String(x.id) === String(id));
    }

    function addToMyList(item) {
      const list = getMyList();
      if (list.some(x => String(x.id) === String(item.id))) return;
      list.unshift(item);
      setMyList(list);
      renderMy();
    }

    function removeFromMyList(id) {
      const list = getMyList().filter(x => String(x.id) !== String(id));
      setMyList(list);
      renderMy();
    }

    function renderMy() {
      const list = getMyList();
      if (myCount) myCount.textContent = `${list.length}개`;
      if (!railMy) return;
      if (!list.length) {
        railMy.innerHTML = `
          <div style="min-width: 280px; padding: 14px; color: rgba(255,255,255,0.72); line-height:1.6;">
            아직 담긴 콘텐츠가 없어요. <b>카드를 클릭</b>해서 모달을 열고 <b>+ 내 리스트</b>를 눌러보세요.
          </div>
        `;
        return;
      }
      renderRail(railMy, list);
    }

    renderMy();

    modalAdd?.addEventListener('click', () => {
      const id = modalAdd.dataset.id;
      if (!id) return;
      const item = findItemById(id);
      if (!item) return;

      if (isInMyList(id)) {
        removeFromMyList(id);
        modalAdd.textContent = '+ 내 리스트';
      } else {
        addToMyList(item);
        modalAdd.textContent = '✓ 내 리스트에 있음';
      }

      runSearch(searchInput?.value);
    });

    modalPlay?.addEventListener('click', () => {
      if (!currentModalItem) return;
      toast(`▶ ${currentModalItem.title} 재생 (데모)`);
    });

    document.getElementById('playHero')?.addEventListener('click', () => {
      const hero = STATE.netflix[0] || STATE.trending[0];
      toast(`▶ ${hero?.title || '콘텐츠'} 재생 (데모)`);
    });

    document.getElementById('infoHero')?.addEventListener('click', () => {
      const hero = STATE.netflix[0] || STATE.trending[0];
      if (hero) openModal(hero);
    });

    document.getElementById('muteHero')?.addEventListener('click', () => {
      toast('음소거 (데모)');
    });

    document.getElementById('addHero')?.addEventListener('click', () => {
      const hero = STATE.netflix[0] || STATE.trending[0];
      if (!hero) return;
      addToMyList(hero);
      toast('+ 내 리스트에 추가');
      runSearch(searchInput?.value);
    });

    // ------------------------------
    // Search drawer
    // ------------------------------
    function openDrawerFn() {
      if (!drawer) return;
      drawer.classList.add('open');
      drawer.setAttribute('aria-hidden', 'false');
      setTimeout(() => searchInput?.focus(), 0);
      runSearch(searchInput?.value);
    }

    function closeDrawerFn() {
      if (!drawer) return;
      drawer.classList.remove('open');
      drawer.setAttribute('aria-hidden', 'true');
    }

    openSearch?.addEventListener('click', openDrawerFn);
    closeDrawer?.addEventListener('click', closeDrawerFn);

    drawer?.addEventListener('click', (e) => { if (e.target === drawer) closeDrawerFn(); });

    function runSearch(q) {
      if (!searchResult) return;
      const query = String(q || '').trim().toLowerCase();
      const hay = [...STATE.netflix, ...STATE.trending, ...STATE.new, ...STATE.top10, ...STATE.comedy, ...STATE.action, ...STATE.doc, ...getMyList()]
        .reduce((acc, item) => {
          if (!acc.some(x => String(x.id) === String(item.id))) acc.push(item);
          return acc;
        }, []);

      const list = query
        ? hay.filter(item => item.title.toLowerCase().includes(query))
        : hay.slice(0, 12);

      searchResult.innerHTML = list.length
        ? list.map(item => `
            <div class="item" data-id="${item.id}">
              <div class="ph" style="background-image:url('${item.img}')"></div>
              <div>
                <p class="name">${escapeHtml(item.title)}</p>
                <p class="meta">${escapeHtml(item.genre)} · ${escapeHtml(item.year)} · ${escapeHtml(item.quality)}</p>
              </div>
            </div>
          `).join('')
        : `<div style="color: rgba(255,255,255,0.72); line-height:1.6; padding: 10px;">검색 결과가 없어요.</div>`;
    }

    searchBtn?.addEventListener('click', () => runSearch(searchInput?.value));
    searchInput?.addEventListener('input', () => runSearch(searchInput?.value));

    searchResult?.addEventListener('click', (e) => {
      const itemEl = e.target.closest('.item');
      if (!itemEl) return;
      const found = findItemById(itemEl.dataset.id);
      if (!found) return;
      closeDrawerFn();
      openModal(found);
    });

    // Auth (login modal)
    function openLogin() {
      if (!loginModal) return;
      loginModal.classList.add('open');
      loginModal.setAttribute('aria-hidden', 'false');
      setTimeout(() => document.getElementById('loginEmail')?.focus(), 0);
    }

    function closeLogin() {
      if (!loginModal) return;
      loginModal.classList.remove('open');
      loginModal.setAttribute('aria-hidden', 'true');
    }

    document.getElementById('btnSignIn')?.addEventListener('click', (e) => {
      e.preventDefault();
      openLogin();
    });
    document.getElementById('openLoginFooter')?.addEventListener('click', (e) => {
      e.preventDefault();
      openLogin();
    });

    document.getElementById('btnJoin')?.addEventListener('click', () => toast('가입 화면은 데모입니다 🙂'));

    document.getElementById('closeLogin')?.addEventListener('click', closeLogin);
    loginModal?.addEventListener('click', (e) => { if (e.target === loginModal) closeLogin(); });

    document.getElementById('forgotPw')?.addEventListener('click', (e) => {
      e.preventDefault();
      toast('비밀번호 재설정은 데모입니다 🙂');
    });

    document.getElementById('createAccount')?.addEventListener('click', (e) => {
      e.preventDefault();
      toast('회원가입은 데모입니다 🙂');
    });

    document.getElementById('loginForm')?.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail')?.value?.trim();
      const pw = document.getElementById('loginPassword')?.value;

      // 데모 로그인: 입력만 확인
      if (!email || !pw) {
        toast('이메일과 비밀번호를 입력해주세요.');
        return;
      }

      toast(`환영합니다, ${email}`);
      closeLogin();
    });

    // ------------------------------
    // Tiny self-tests (open with #test)
    // ------------------------------
    function runSelfTests() {
      const log = (ok, name, extra = '') => {
        const prefix = ok ? '✅' : '❌';
        console[ok ? 'log' : 'error'](`${prefix} ${name}${extra ? ' — ' + extra : ''}`);
      };

      try {
        log(!!railNetflix && !!railTrending && !!railNew && !!railTop && !!railComedy && !!railAction && !!railDoc, 'All rails exist in DOM');
        log(escapeHtml('<b>') === '&lt;b&gt;', 'escapeHtml works');
        log(formatYear('2023-12-31') === '2023', 'formatYear works');

        const sampleTv = mapTvToCard({
          id: 2,
          name: 'TV',
          first_air_date: '2021-02-03',
          vote_average: 8.0,
          overview: 'desc',
          poster_path: null,
          backdrop_path: null,
        }, 0);
        log(sampleTv.genre === 'TV' && Number.isInteger(sampleTv.seasons) && Number.isInteger(sampleTv.episodes), 'TV seasons/episodes exist');

        const sampleMovie = mapMovieToCard({
          id: 3,
          title: 'Movie',
          release_date: '2020-01-01',
          vote_average: 7.5,
          overview: 'desc',
          adult: false,
          poster_path: null,
          backdrop_path: null,
        }, 0);
        log(sampleMovie.genre === 'Movie' && typeof sampleMovie.minutes === 'number', 'Movie minutes exist');
      } catch (e) {
        console.error('Self tests failed:', e);
      }
    }

    if (location.hash === '#test') runSelfTests();

    // Init
    loadRails();
  </script>
</body>
</html>


